<!DOCTYPE html>
<html lang="en">
<head>
  <title>Jian Chen - Home </title>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <meta name="verify-v1" content="fI45uNHehVNiO9Dt0Fp7XnsV0Z/ozBTkPoS6RlYAe50=" />
  <meta name="y_key" content="6c948e75a617b12d" />
  <meta name='technorati-claim' content='8QN7CWNH8BSJ' />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" media="screen" href="/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="/css/default.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Jian's blog" />
</head>

<body class='blog'>
  <div class="container">
    <div class="row">
      <div class="span4 sidebar affix">
        <div class="well">
          <h2 class='site-title'>
            <a href="http://ericcj24.github.io">Jian Chen</a>
          </h2>

          <p>ad astra !</p>

          <ul id="navigation" class="clearfix">
            <li class='about'><a href='/about/'>About</a></li>
            <li class="resume"><a href="/Resume_JianChen_2014_3C.pdf" rel="me" class="url">resume</a></li>
            <li class='archives'><a href='/archives/'>Archives</a></li>
            <li class="github"><a href="http://github.com/ericcj24" rel='me' class='url'>@github</a></li>
            <!--<li class="acknowledgement"><a href="/acknowledgment/">acknowledgment</a></li>-->
          </ul>
        </div>
      </div>
      <div class="span8 main offset4">
        <div class="well">
          <div id='index'>

  <div class="post">
    <h2><a href="/2013/07/29/oauth2-authorization-using-python/">OAuth2 Authorization Using Python</a></h2>

    <h3>Overview</h3>
<p>As promised I am going to talk about getting the authorization from OAuth2. OAuth2 is a popular authorization protocol used by website like twitter, and other social websites in their APIs. Basic OAuth2 authorization involves two stages: first obtain authorization code, second obtain access_token.</p>
<h3>Python Demo</h3>
<p>Taking social website Douban as an example<br />
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">SCOPE</span> <span class="o">=</span> <span class="s">&#39;douban_basic_common,shuo_basic_r,shuo_basic_w&#39;</span> <span class="c"># getting more access by adding more parameters</span>
<span class="n">APP_KEY</span> <span class="o">=</span> <span class="n">YOUR_APP_KEY</span> <span class="c"># sometimes called API_KEY, obtain upon registration for API</span>
<span class="n">APP_SECRET</span> <span class="o">=</span> <span class="n">YOUR_APP_SECRET</span> <span class="c"># sometimes called API_SECRET, obtain upon registration for API</span>
<span class="n">REDIRECT_URI</span> <span class="o">=</span> <span class="n">YOUR_CALLBACK_URI</span> <span class="c"># this http address would be the address to receive authorization code, and access_token returned from website</span>
<span class="n">DOUBAN_RESPONSE_TYPE</span> <span class="o">=</span> <span class="s">&#39;code&#39;</span>
<span class="n">DOUBAN_AUTHORIZATION_URI</span> <span class="o">=</span> <span class="s">&quot;https://www.douban.com/service/auth2/&quot;</span>
<span class="n">DOUBAN_ACCESS_TOKEN_URI</span> <span class="o">=</span> <span class="s">&quot;https://www.douban.com/service/auth2/&quot;</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;client_id&#39;</span><span class="p">:</span><span class="n">APP_KEY</span><span class="p">,</span> <span class="s">&#39;redirect_uri&#39;</span><span class="p">:</span><span class="n">REDIRECT_URI</span><span class="p">,</span><span class="s">&#39;response_type&#39;</span><span class="p">:</span><span class="s">&#39;code&#39;</span><span class="p">,</span><span class="s">&#39;scope&#39;</span><span class="p">:</span><span class="n">SCOPE</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">DOUBAN_AUTHORIZATION_URI</span><span class="o">+</span><span class="n">params</span>
<span class="c"># now, go to your browser, go to your generated url, click on accept authorization, then you would be redirect to REDIRECT_URI+code=YOUR_AUTHORIZATION_CODE, the YOUR_AUTHORIZATION_CODE would be appended at the end of that address</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">YOUR_AUTHORIZATION_CODE</span>
<span class="c"># up to this point, you finished first step, obtain authorization code</span>
<span class="n">v2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;client_id&#39;</span><span class="p">:</span><span class="n">APP_KEY</span><span class="p">,</span> <span class="s">&#39;client_secret&#39;</span><span class="p">:</span><span class="n">APP_SECRET</span><span class="s">&#39;,&#39;</span><span class="n">redirect_uri</span><span class="s">&#39;:REDIRECT_URI, &#39;</span><span class="n">grant_type</span><span class="s">&#39;:&#39;</span><span class="n">authorization_code</span><span class="s">&#39;,&#39;</span><span class="n">code</span><span class="s">&#39;:code}</span>
<span class="n">url2</span> <span class="o">=</span> <span class="n">DOUBAN_ACCESS_TOKEN_URI</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url2</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">v2</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="c"># should be 200 if everything is right</span>
<span class="n">r_json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="c"># now you could see response in json format, with access_token in it</span>
</code></pre></div></p>
<p>Just remember that first stage uses <span class="caps">HTTP</span> method <span class="caps">GET</span>, second stage uses <span class="caps">HTTP</span> method <span class="caps">POST</span> (that means you have to pass your encoded v2 to data, instead of params!!!)</p>
<p>Now you should have your access_token, go nuts!</p>

    <small class="meta">July 29, 2013 | <a href='/2013/07/29/oauth2-authorization-using-python/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/28/a-little-note-on-douban-api/">A Little Note on Douban API</a></h2>

    <h3>Overview</h3>
<p>Douban is a popular Chinese social cultural site. It integrates Book reading, movie criticism, city events, and miniblog together. <br />
From my past couple day&#8217;s experience, though most Chinese social websites open their <span class="caps">API</span>, but they all have different &#8216;tricks&#8217; to successfully send your http post and get commands. I had been confused on Douban&#8217;s photo uploading format for a while, and now I was hoping to share the points you should be careful when uploading your photo using urllib and urllib2 libraries from python.</p>
<h3>Encode your photo</h3>
<p>The format to encode the photo to pass to Douban could be very restrict. The following format works:</p>
<div class="highlight"><pre><code class="xml">------------0x14026e4be72\r\n
Content-Disposition: form-data; name=&quot;text&quot;\r\n\r\nDraw\r\n------------0x14026e4be72\r\n
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;hidden&quot;\r\n
Content-Length: 2019551\r\n
Content-Type: image/jpeg\r\n
Content-Transfer-Encoding: binary\n\r\n
YOUR_IMAGE BYTES
\r\n------------0x140297140d1\r\nContent-Disposition: form-data; name=&quot;source&quot;\r\n\r\nYOUR_APP_KEY\r\n------------0x140297140d1--\r\n
</code></pre></div><p>Things you should really keep in mind is that Douban needs a clear declaration of Content-Type, you need to restrictedly follow the format. Use mimetypes.types_map would return you a dictionary of types they have, and you could pass your uploading file&#8217;s extension as a key into mimetypes.types_map.get(YOUR_FILE_EXTENTION), and it should return you the correct answer for Content-Type. <br />
Also, 0&#215;14026e4be72 is just the boundary variable you could generate randomly.</p>
<p>Following is the python code:<br />
test_douban class</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">gzip</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">mimetypes</span>

<span class="k">def</span> <span class="nf">_encode_multipart</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="s">&#39; build a multipart/form-data body with randomly generated boundary &#39;</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="s">&#39;----------</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&#39;read&#39;</span><span class="p">):</span>
            <span class="c"># file-like object:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Disposition: form-data; name=&quot;</span><span class="si">%s</span><span class="s">&quot;; filename=&quot;hidden&quot;&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Length: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Type: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_guess_content_type</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Transfer-Encoding: binary</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Disposition: form-data; name=&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="s">--</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">boundary</span>

<span class="k">def</span> <span class="nf">_guess_content_type</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;application/octet-stream&#39;</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c"># mimetyeps.types_map keys are stored in lower case, ex: &#39;.jpeg&#39;</span>
    <span class="k">return</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">types_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="s">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</code></pre></div><p>This version of code is heavily depends on the existed code from internet. I just amended little bit on the encoding part to make the format be accepted by Douban.</p>
<p>call test_douban class</p>
<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">test_douban</span> <span class="kn">import</span> <span class="n">_encode_multipart</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.douban.com/shuo/v2/statuses/&#39;</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="n">YOUR_ACCESS_TOKEN</span>
<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">PATH_TO_YOUR_IMAGE_FILE</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">THINGS_YOU_WANT_TO_SAY</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:</span><span class="n">status</span><span class="p">,</span> <span class="s">&#39;image&#39;</span><span class="p">:</span><span class="n">fh</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">:</span><span class="n">YOUR_APP_KEY</span><span class="p">}</span>
<span class="n">coded_params</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="n">_encode_multipart</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="c"># after previews call, you have the encoded photo, and a random generated boundary</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coded_params</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept-Encoding&#39;</span><span class="p">,</span> <span class="s">&#39;gzip&#39;</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s">&#39;Bearer </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s">&#39;multipart/form-data; boundary=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</code></pre></div><p>Now you should see the photo you just post on Douban&#8217;s miniblog. Cheers !</p>

    <small class="meta">July 28, 2013 | <a href='/2013/07/28/a-little-note-on-douban-api/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/24/a-little-learning-on-api/">A Little Learning on API</a></h2>

    <h3>Overview</h3>
<p><span class="caps">API</span> stands for <a href="http://en.wikipedia.org/wiki/,Application_programming_interface">Application Programming Interface</a>. In the information age, there are huge amount of data generating everyday, most of them are being ignored and not substantially recognized for their values. A web <span class="caps">API</span> enables a third party program to access online data servers like <span class="caps">NPR</span> (national public radio) and sunlight foundation to gain news and political materials. A good idea of reorganizing, analysis those free open information could bring up potential  economic value from what seems to be the chaotic data. In this post, I am discussing some basic programming to get access to NPR&#8217;s <span class="caps">API</span>, in the future, I may also post some more complex usage, like access your twitter <span class="caps">API</span> which requires oauth2 authentication.</p>
<h3>Python code</h3>
<p>Python offers wonderful library support for http usage<br />
Python has several version of urllib library: urllib, urllib2, and <a href="http://docs.python-requests.org/en/latest/">requests</a> (which is the third generation of urllib), I highly recommend the usage of requests for its simplicity and easy to understand.</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">query_params</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;apikey&#39;</span><span class="p">:</span> <span class="s">&#39;YOUR API KEY&#39;</span><span class="p">,</span>
		<span class="s">&#39;phrase&#39;</span><span class="p">:</span> <span class="s">&#39;holiday season&#39;</span><span class="p">,</span>
		<span class="s">&#39;start_date&#39;</span><span class="p">:</span><span class="s">&#39;2012-12-12&#39;</span><span class="p">,</span>
		<span class="s">&#39;end_date&#39;</span><span class="p">:</span><span class="s">&#39;2012-12-14&#39;</span><span class="p">,</span>
        <span class="s">&#39;state&#39;</span><span class="p">:</span><span class="s">&#39;CA&#39;</span><span class="p">}</span>

<span class="n">endpoint</span> <span class="o">=</span> <span class="s">&#39;http://capitolwords.org/api/text.json&#39;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">query_params</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span> <span class="n">data</span><span class="p">[</span><span class="s">&quot;num_found&quot;</span><span class="p">]</span>
</code></pre></div><p>This simple example is excerpt from the wonderful online programming tutorial website, <a href="http://www.codecademy.com/">Codecademy</a> ,they offer various entry level programming practice for different programming language, and they also have some entry level <span class="caps">API</span> practices. <br />
A little explanation to the code: <br />
you get information you wanted by, basically, say piece together a unique <span class="caps">URL</span>, then use <span class="caps">HTTP</span> method either &#8216;post&#8217; or &#8216;get&#8217; (basic <span class="caps">HTTP</span> methods are &#8216;get&#8217;, &#8216;post&#8217;, &#8216;put&#8217;, and &#8216;delete&#8217;) you could receive the correspond information you requested, the format of the data package usually are <span class="caps">JSON</span>. Now, the unique <span class="caps">URL</span> we made, through the combination of &#8216;endpoint&#8217; and &#8216;query_params&#8217; is http://capitolwords.org/api/text.json?apikey=YOU_API_KEY&amp;phrase=holiday+season&amp;start_date=2012-12-12&amp;end_date=2012-12-14&amp;state=CA, this is basically telling the server that I am looking for any record, that a California senator spoke at congress between Dec 12, 2012 and Dec 14, 2012, and mentioned the phrase &#8216;holiday season&#8217;, and the server should return the record in <span class="caps">JSON</span> format.</p>
<p>a little note that, see the line where you call requests, you could use different <span class="caps">HTTP</span> methods just by changing the .get to .post following the requests command.</p>
<p>A big data era is ahead of us, now write your <span class="caps">API</span> programs, inspire yourself with more ideas of how data could be reorganized to serve our life better :)</p>

    <small class="meta">July 24, 2013 | <a href='/2013/07/24/a-little-learning-on-api/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/05/karaoke-game-android-app/">Karaoke Game on Android</a></h2>

    <p style="text-align:center;"><img src="/images/posts/2013-07-05/Screenshot_2013-07-05-20-19-13.png" style="max-width:50%;" alt="" /><br />
<p align="center">welcome page</p></p>
<p style="text-align:center;"><img src="/images/posts/2013-07-05/Screenshot_2013-07-05-20-19-34.png" style="max-width:50%;" alt="" /><br />
<p align="center">gaming page</p></p>
<p style="text-align:center;"><img src="/images/posts/2013-07-05/Screenshot_2013-07-05-20-32-27.png" style="max-width:50%;" alt="" /><br />
<p align="center">end of the game page</p></p>
<h3>Overview</h3>
<p>This application is an extension to the original spectrogram application. When people are singing to the microphone, the application calculating the autocorrelation of the sound recorded, it finds the pitch in his voice and compare it to the reference. The reference would be a recording of the piano play of the same song (piano would generate accurate pitch, thus this file, which recored and processed with <span class="caps">MATLAB</span>, could be serve as reference). Every matching between human voice and the reference pitch would gain one point, at the end of the song, a total score would be displayed.<br />
Some key concept may be useful during the signal processing part are: <a href="https://en.wikipedia.org/wiki/Autocorrelation">autocorrelation</a> , <a href="http://en.wikipedia.org/wiki/Voice_activity_detection">voice detection</a></p>
<h3><span class="caps">MATLAB</span> simulation</h3>
<p><span class="caps">MATLAB</span> main function call</p>
<div class="highlight"><pre><code class="matlab"><span class="n">numdatablc</span> <span class="p">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">a4</span><span class="p">)</span><span class="o">/</span><span class="mi">256</span><span class="p">;</span> <span class="c">% number of data blocks, each block has 256 points, store in variable a4</span>
<span class="n">pdata1</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">numdatablc</span><span class="p">);</span> <span class="c">% initialize return array</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="n">numdatablc</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">temp</span> <span class="p">=</span> <span class="n">a4</span><span class="p">(</span><span class="nb">i</span><span class="o">*</span><span class="mi">256</span><span class="o">+</span><span class="mi">1</span><span class="p">:(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">256</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">voidet</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="c">% do voice detection</span>
        <span class="n">pdata1</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">proc</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">f</span><span class="p">);</span> <span class="c">% do autocorrelation</span>
    <span class="k">else</span>
        <span class="n">pdata1</span><span class="p">(</span><span class="nb">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div><p><span class="caps">MATLAB</span> function for autocorrelation and pitch finding</p>
<div class="highlight"><pre><code class="matlab"><span class="k">function</span><span class="w"> </span>[ y ] <span class="p">=</span><span class="w"> </span><span class="nf">proc</span><span class="p">(</span> x,f <span class="p">)</span><span class="w"></span>
<span class="c">% f: sampling frequency</span>
<span class="c">% filter</span>
<span class="c">% f_pi/pi = f/4Khz</span>
<span class="c">% f_pi = 2pi/range</span>
<span class="c">% range = 8KHz/f = indx_max - indx_sec_max</span>
<span class="c">% human vocal range: 75 ~ 500 Hz</span>
<span class="c">% range: 8000/500 ~ 8000/75 =&gt; floor 16 ~ 107</span>
<span class="n">lowr</span> <span class="p">=</span> <span class="nb">floor</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mi">500</span><span class="p">);</span> 
<span class="n">upr</span> <span class="p">=</span> <span class="nb">ceil</span><span class="p">(</span><span class="n">f</span><span class="o">/</span><span class="mi">75</span><span class="p">);</span>
<span class="n">x_cor</span> <span class="p">=</span> <span class="n">xcorr</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="n">x_filt</span> <span class="p">=</span> <span class="n">x_cor</span><span class="p">;</span>
<span class="p">[</span><span class="n">xmax</span><span class="p">,</span> <span class="n">po</span><span class="p">]</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="n">x_filt</span><span class="p">);</span>
<span class="n">x_filt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">lowr</span><span class="o">+</span><span class="n">po</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">x_filt</span><span class="p">(</span><span class="n">po</span><span class="o">+</span><span class="n">upr</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">)</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">[</span><span class="n">xmax1</span><span class="p">,</span><span class="n">pmax</span><span class="p">]</span> <span class="p">=</span> <span class="n">max</span><span class="p">(</span><span class="n">x_filt</span><span class="p">);</span>
<span class="n">y</span> <span class="p">=</span> <span class="n">f</span><span class="o">/</span><span class="p">(</span><span class="n">pmax</span><span class="o">-</span><span class="n">po</span><span class="p">);</span>
<span class="k">end</span>
</code></pre></div><p><span class="caps">MATLAB</span> function for voice detection</p>
<div class="highlight"><pre><code class="matlab"><span class="k">function</span><span class="w"> </span>[ y ] <span class="p">=</span><span class="w"> </span><span class="nf">voidet</span><span class="p">(</span>x<span class="p">)</span><span class="w"></span>
<span class="n">x2</span> <span class="p">=</span> <span class="n">x</span><span class="o">.^</span><span class="mi">2</span><span class="p">;</span>
<span class="n">xs</span> <span class="p">=</span> <span class="n">sum</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="k">if</span> <span class="n">xs</span> <span class="o">&gt;</span> <span class="mi">50000000</span> <span class="c">%2.56</span>
    <span class="n">y</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">y</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">end</span>
<span class="k">end</span>
</code></pre></div><p style="text-align:center;"><img src="/images/posts/2013-07-05/piano_test.jpg" style="max-width:50%;" alt="" /><br />
<p align="center">showing the calculated pitch from piano recording</p></p>
<p style="text-align:center;"><img src="/images/posts/2013-07-05/song_processed.jpg" style="max-width:50%;" alt="" /><br />
<p align="center">alphabet song recording processed (show pitch vs. data-time), the middle simulation has been manually corrected to be more smooth to serve as reference file</p></p>
<h3>Android app development</h3>
<p style="text-align:center;"><img src="/images/posts/2013-07-05/flowchart.jpg" style="max-width:50%;" alt="" /></p>
<p>During the song playing, lyrics would scrolling though the screen, real-time calculated pitch and score displayed on the screen, and real-time spectrogram would be scrolling through the right part of the screen with the pitch (the fundamental frequency of a human voice, usually the lowest frequency among all the harmonics) mapped out on the screen in red.</p>
<p>This is really a funny project that combines signal processing theory with practical gaming experience.</p>
<p>This is the free choice of the final project of the Embedded Digital Signal Processing (<span class="caps">DSP</span>) lab, the source code of the project could be found <a href="https://github.com/ericcj24/Karaoke-Game-Android-App">here</a></p>

    <small class="meta">July 05, 2013 | <a href='/2013/07/05/karaoke-game-android-app/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/04/wildfire-monitor-system/">Wildfire Monitor System: a project proposal</a></h2>

    <p>Every year we watched from the news about wildfire in western part of the US. It costed lots of money and human resource to fight those vicious natural disaster. After watching the news that 19 firefighters had died during a recent wildfire in Arizona, I started to think about how we could approach this problem from a technology angle.</p>
<p>Following graph shows the implementation of my solution to wildfire prevention and monitoring:</p>
<p style="text-align:center;"><img src="/images/posts/2013-07-04/Slide3.jpg" style="max-width:50%;" alt="" /></p>
<h3>Design Overview</h3>
<p>My design includes two major modules: the ground computer hub and the <span class="caps">UAV</span> monitor unit.<br />
The <span class="caps">UAV</span> unit equips with:</p>
<ul>
	<li>heat sensor</li>
	<li><span class="caps">GPS</span> chip</li>
	<li>microprocessor</li>
	<li>RF transmitter</li>
	<li>High resolution camera</li>
</ul>
<p>Computer hub features:</p>
<ul>
	<li>RF receiver</li>
	<li>Human monitoring in front of computer</li>
	<li>Google Map <span class="caps">API</span> to help map out the ground of wildfire</li>
</ul>
<h3>Implementation of the project</h3>
<p>The project would be implemented to each local forestry administration. Each location would have one ground unit, and one <span class="caps">UAV</span> in charge of sweeping a certain area.<br />
At the beginning stage, <span class="caps">UAV</span> would proceed a preliminary sweep to map-out heat-spots from human habitation, and non-threaten source, the data from the first sweep would be processed with Google Map <span class="caps">API</span> to make a reference map. <br />
Future routinely sweep data would be compared to this reference map on the fly. If a new heat-spot occurs, the <span class="caps">UAV</span> would take a picture of the scene and send the picture together with the <span class="caps">GPS</span> coordinates back the base station. <br />
In base station, human worker would investigate the picture, assess the situation and make further decision on either to send out firefighter-jets to put out the fire.</p>
<h3>Some interesting challenges may occur</h3>
<ul>
	<li>how to make more fuel-efficiency UAVs (solar panel, battery)</li>
	<li>design low energy consume <span class="caps">GPS</span> circuit &amp; microprocessor</li>
	<li>most market existed <span class="caps">GPS</span> module output standard <span class="caps">NMEA</span> string, convert(A/D) and decipher this information into <span class="caps">GPS</span> coordinates</li>
	<li>design reliable RF communication between <span class="caps">UAV</span> and base</li>
	<li>implement Google Map <span class="caps">API</span></li>
</ul>

    <small class="meta">July 04, 2013 | <a href='/2013/07/04/wildfire-monitor-system/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/03/spectrugram-android-app/">Spectrogram on Android</a></h2>

    <p>A spectrogram could display several qualities of sound in a graphical way. It could map out the frequency of the sound component, color-code its intensity at each frequency.</p>
<p>As part of my Embedded <span class="caps">DSP</span> lab, we built this spectrogram program on Android platform. It records the sound, use <a href="http://developer.android.com/tools/sdk/ndk/index.html">Android <span class="caps">NDK</span> package</a> to embed C code into Android program to process the sound with Fourier Transform and outputs its spectrogram.</p>
<p style="text-align:center;"><img src="/images/posts/2013-07-03/spectrogram.png" style="max-width:50%;" alt="" /><br />
<p align="center">pic 1</p></p>
<p>pic 1 shows the spectrogram of human voice, with different harmonics and intensity at each harmonic</p>
<p>The program&#8217;s sampling frequency is set at 8000Hz, thus it could detect highest frequency of 4000Hz without aliasing.</p>
<p>This is part of the Embedded Digital Signal Processing (<span class="caps">DSP</span>) lab, the code of this program could be found <a href="https://github.com/ericcj24/Spectrogram-DSP-Android-App">here</a></p>

    <small class="meta">July 03, 2013 | <a href='/2013/07/03/spectrugram-android-app/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/03/image-processing-android-app/">Image Processing on Android</a></h2>

    <p>This image processing app features <a href="http://en.wikipedia.org/wiki/Histogram">histogram</a> and <span class="caps">RGB</span> coloring.</p>
<p>The application&#8217;s main frame is developed on Android Eclipse platform (Android <span class="caps">SDK</span>), I also used a <span class="caps">NDK</span> package to embed C++ code in <span class="caps">JAVA</span> to do the image processing part.The program has a <a href="http://opencv.org/">OpenCV</a> dependency, as the program calls some computer vision class from the OpenCV library.The successful install and run the program on Android device, a <a href="https://play.google.com/store/apps/details?id=org.opencv.engine&amp;hl=en">OpenCV Manager</a> from Google Play is also needed.</p>
<p style="text-align:center;"><img src="/images/posts/2013-07-03/rgb_color.png" style="max-width:50%;" alt="" /></p>
<p align="center">pic 1</p>
<p>This screenshot (pic 1) shows the app with the <span class="caps">RGB</span> color option chosen</p>
<p style="text-align:center;"><img src="/images/posts/2013-07-03/histogram.png" style="max-width:50%;" alt="" /><br />
<p align="center">pic 2</p><br />
This screenshot (pic 2) shows the app with the histogram option chosen, as left half of the image has a clearer detail of the object in the far distance</p>
<p>This project is part of the Embedded Digital Signal Processing (<span class="caps">DSP</span>) class, the code could be found <a href="https://github.com/ericcj24/Image-Processing-Android-App">here</a> .</p>

    <small class="meta">July 03, 2013 | <a href='/2013/07/03/image-processing-android-app/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/02/hello-world/">Hello World</a></h2>

    <p style="text-align:center;"><img src="/images/posts/2013-07-03/JessevanDijk.jpg" style="max-width:80%;" alt="" /></p>
<p>Hello World</p>
<p>(photo courtesy of <a href="http://jessevandijkart.com/">Jesse van Dijk</a> )</p>

    <small class="meta">July 02, 2013 | <a href='/2013/07/02/hello-world/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/01/01/shade/">Shade</a></h2>

    <p style="text-align:center;"><img src="/images/posts/2013-07-30/gates_title.jpg" style="max-width:80%;" alt="" /><br />
<p align="center">photo courtesy: Mary Altaffer/Associated Press</p></p>
<p>When it comes to travel with your family in the park on a sunny Sunday, people always come to appreciate that shaded area under the tree, or beside the building.</p>
<p>Art Duo <a href="https://en.wikipedia.org/wiki/Christo_and_Jeanne-Claude">Christo and Jeanne-Claude</a> who are famous for their international series of large-sale outdoor installations. They used to took years to gain their permission to put their installations in central park.I admire their artistic spirit and appreciate their wonderful effort to bring inspirations to urban life.</p>
<p>They first proposed the project in 1979, but it was not approved until 2005.</p>
<p><a href="http://www.christojeanneclaude.net/projects/the-gates?images=completed#.Ud7zaD7TVcQ">The Gates</a>, project for central park, New York City, 2005<br />
Also on <a href="https://en.wikipedia.org/wiki/Christo_and_Jeanne-Claude#The_Gates">wikipedia</a> and <a href="http://www.nytimes.com/ref/arts/design/GATES-REF.html">New York Times</a></p>
<p>Technology should also create a better living environment and inspire creativity.</p>

    <small class="meta">January 01, 2013 | <a href='/2013/01/01/shade/#disqus_thread'>View Comments</a></small>
  </div>

</div>

<div class='paging'>
  

  
    <a href='/' class='newer'>Newer Posts</a>
  

  
  <div class='clear'></div>
</div>

        </div>
      </div>

      <div id="bottom" class="span8 offset4">
        <div class="well">
          <a href="/about/">About</a> |
          <a href="/archives/">Archives</a> |
          <a href="/acknowledgment/">Courtesy</a> |
          <a href="/atom.xml">feed</a>
        </div>
      </div>
    </div>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/bootstrap.min.js"></script>

  <!-- Google Analytics Code 
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9947336-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
          'http://www') + '.google-analytics.com/ga.js';
      ga.setAttribute('async', 'true');
      document.documentElement.firstChild.appendChild(ga);
    })();

  </script>  -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-42183274-1', 'ericcj24.github.io');
        ga('send', 'pageview');
        
    </script>
    
</body>
</html>

