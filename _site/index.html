<!DOCTYPE html>
<html lang="en">
<head>
  <title>Jian Chen - Home </title>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
  <meta name="verify-v1" content="fI45uNHehVNiO9Dt0Fp7XnsV0Z/ozBTkPoS6RlYAe50=" />
  <meta name="y_key" content="6c948e75a617b12d" />
  <meta name='technorati-claim' content='8QN7CWNH8BSJ' />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" media="screen" href="/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="/css/default.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Jian's blog" />
</head>

<body class='blog'>
  <div class="container">
    <div class="row">
      <div class="span4 sidebar affix">
        <div class="well">
          <h2 class='site-title'>
            <a href="http://ericcj24.github.io">Jian Chen</a>
          </h2>

          <p>ad astra !</p>

          <ul id="navigation" class="clearfix">
            <li class='about'><a href='/about/'>About</a></li>
            <li class="resume"><a href="/Resume_JianChen_2014_3C.pdf" rel="me" class="url">resume</a></li>
            <li class='archives'><a href='/archives/'>Archives</a></li>
            <li class="github"><a href="http://github.com/ericcj24" rel='me' class='url'>@github</a></li>
            <!--<li class="acknowledgement"><a href="/acknowledgment/">acknowledgment</a></li>-->
          </ul>
        </div>
      </div>
      <div class="span8 main offset4">
        <div class="well">
          <div id='index'>

  <div class="post">
    <h2><a href="/2014/04/11/bitstamp-api-android/">Bitstamp API Client on Android</a></h2>

    <p>I am making a simple Android app to graphically display Bitstamp&#8217;s trading data through their <a href="https://www.bitstamp.net/api/"><span class="caps">API</span></a>.</p>
<p>The app utilizes an open source Android charting library called <a href="http://androidplot.com/">Androidplot</a>, and a slide menu from <a href="https://github.com/dmitry-zaitsev/AndroidSideMenu/">here</a>.<br />
The app features AlarmManager to repeatly firing IntentService, the later&#8217;s working thread would be pulling data from Bitstamp <span class="caps">API</span> (making http calls), and if there are new data, update database (sqlite) accordingly, once database is updated, a Broadcast is sent to the main UI thread and updates the chart.</p>
<p><strike><a href="https://github.com/ericcj24/simple-bitstamp-api-androidclient">Check it out</a></strike><br />
new repo <a href="https://github.com/ericcj24/bitstamp-api-android2">here</a> .<br />
I have been exploiting with different designs to approach this problem, here is the newest version, check it out :) <a href="https://github.com/ericcj24/bitstamp-api-android3">repo</a></p>
<p>I will try to add more functionality in project in the following days :)</p>
<p>Cheers</p>

    <small class="meta">April 11, 2014 | <a href='/2014/04/11/bitstamp-api-android/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2014/03/25/bitstamp-api/">Bitstamp API</a></h2>

    <p>I am making a simple <span class="caps">GUI</span> java app to graphically display Bitstamp&#8217;s trading data through their <a href="https://www.bitstamp.net/api/"><span class="caps">API</span></a>.</p>
<p>The java app utilizes apache&#8217;s <a href="http://hc.apache.org/httpclient-3.x/">httpclient library</a> to make http connection, uses <a href="http://jackson.codehaus.org/">Jackson</a> to bind <span class="caps">JSON</span> data to Java class and/or generic containers.</p>
<p><strike>The app also uses <a href="https://code.google.com/p/jmathplot/">jmathplot libary</a> to help plot the data.</strike><br />
After careful considration, I switched my ploting tool to <a href="http://www.jfree.org/jfreechart/">JFreeChart</a> for its detailed documentation.</p>
<p><strike>Find it at my project <a href="https://github.com/ericcj24/bitstamp.api.monitor">repo</a> </strike><br />
I have also changed the new project to a newer <a href="https://github.com/ericcj24/bitstamp.api.monitor1">repo</a></p>
<p>I will try to add more functionality in project in the following days :)</p>
<p>Cheers</p>

    <small class="meta">March 25, 2014 | <a href='/2014/03/25/bitstamp-api/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/10/28/twitter-api/">Twitter API</a></h2>

    <p>Twitter is a little vague in terms of how you could make your first ‘hello world’ post, that’s why I am writing this post for your convenient.</p>
<p>If you, like me, always like to write a python script with Requests library on the spot just to quick-test some new APIs you encountered, you could be, just like me, puzzled by Twitter API’s authentication. Thanks to this <a href="http://thomassileo.com/blog/2013/01/25/using-twitter-rest-api-v1-dot-1-with-python/">dude</a> ’s hint, I finally made a successful Twitter post (a tweet) through my what was supposed to be simple python script.</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">requests_oauthlib</span> <span class="kn">import</span> <span class="n">OAuth1</span>
<span class="n">url</span><span class="o">=</span><span class="s">&#39;https://api.twitter.com/1.1/statuses/update.json&#39;</span>
<span class="c">#i am making a tweet http post call</span>
<span class="n">auth</span><span class="o">=</span><span class="n">OAuth1</span><span class="p">(</span><span class="s">&#39;CONSUMER_KEY&#39;</span><span class="p">,</span><span class="n">client_secret</span><span class="o">=</span><span class="s">&#39;CONSUMER SECRET&#39;</span><span class="p">,</span><span class="n">resource_owner_key</span><span class="o">=</span><span class="s">&#39;OAUTH TOKEN&#39;</span><span class="p">,</span><span class="n">resource_owner_secret</span><span class="o">=</span><span class="s">&#39;OAUTH TOKEN SECRET&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;status&#39;</span><span class="p">:</span><span class="s">&#39;hello&#39;</span><span class="p">},</span><span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="p">)</span>
</code></pre></div><p>So you should realize that there is OAuth1 function in Requests that helps you encode all the authorization parameters. And it seems like Twitter only takes that for a successful authorization. otherwise you get a 400 error saying not valid authorization :(<br />
Of course, prior to make this call, you need to create/register your Twitter app at their developer page, and set app’s authorization to both read <span class="caps">AND</span> write. then, you could generate your token and secret. Be sure to generate token <span class="caps">AFTER</span> you set app’s authorization :D Once you have all consumer_secret, consumer_key, oauth_token, and oauth_token_secret, you are set to go! Cheers!!!</p>

    <small class="meta">October 28, 2013 | <a href='/2013/10/28/twitter-api/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/10/13/a-brief-summary-on-interview-experience/">A Brief Reflection on my Interviews</a></h2>

    <p>I have been doing interviews for a while now, companies I interviewed with range from big names to small inspiring start-ups. Here is a little murmuring of my reflections on it.</p>
<p>In the data structure class, we know we could traverse a tree in two basic fashion, depth-first and breadth-first, each of the traversing methods has recursive and iterative two ways to implement(well I think every recursive implementation has its iterative way to implement), in the iterative way depth-first traverse we usually use a stack as a helping data structure to traverse through the tree, while in breadth-first, we use a queue (a <span class="caps">FIFO</span> first in first out structure).</p>
<div class="highlight"><pre><code class="c++"><span class="cp">#include &lt;iostream&gt;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>

<span class="n">breadth_first_traversal</span><span class="p">(</span><span class="n">Node</span><span class="o">*</span> <span class="n">croot</span><span class="p">){</span>
    <span class="n">queue</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">*&gt;</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">Node</span><span class="o">*</span> <span class="n">level</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">height</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">croot</span><span class="p">){</span>
        <span class="n">q</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">croot</span><span class="p">);</span>
        <span class="n">q</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">level</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">()){</span>
            <span class="n">Node</span><span class="o">*</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">dequeue</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="o">==</span><span class="n">level</span><span class="p">){</span>
                <span class="n">height</span><span class="o">++</span><span class="p">;</span>
		<span class="n">q</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">level</span><span class="p">);</span>	
                <span class="n">temp</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">dequeue</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">value</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">)</span> <span class="n">q</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">left</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">)</span> <span class="n">q</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">temp</span><span class="o">-&gt;</span><span class="n">right</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>The brief code showed how powerful breadth-first search could be, it could help you traverse through each node of a tree, while help you keep track of the height of the tree. In my recent interview questions, I also encountered a question that ask me to implement an iterator for a general tree class, given by the short timing, I also found that the same breadth-first traverse philosophy could apply to the problem, using a queue structure as iterator, checking if the queue is empty to see if this iterator &#8216;hasNext&#8217;. And in another question, where a brief Facebook Member class is defined, which includes a name and a email address of the user, and a list of his friends (List<Member>), the question was to ask you to write a function that print out user&#8217;s friends first (level 1), then user&#8217;s friends&#8217; friends (level 2), and etc etc. You could still use the queue to help you do a breadth-first search to solve the similar problem.<br />
Happy Halloween :D Cheers !</p>

    <small class="meta">October 13, 2013 | <a href='/2013/10/13/a-brief-summary-on-interview-experience/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/09/15/a-binary-search-in-sorted-array/">Binary Search in Sorted Array</a></h2>

    <h3>Overview</h3>
<p>This is the code that do a binary search for a value in a sorted array.</p>
<h3>C++ code</h3>
<div class="highlight"><pre><code class="c++"><span class="cp">#include &lt;iostream&gt;</span>
<span class="k">using</span> <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">Find</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">){</span>
<span class="c1">//sizeof(a)/sizeof(a[0]) would not give the correct size of array, as sizeof(a) here gives the size of pointer, not the entire array!!!</span>
<span class="c1">// that is why you need to pass size info of the array to save the trouble</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="o">==</span><span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>	
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">size</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&gt;</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">-</span><span class="n">size</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">v</span><span class="p">){</span>	
	    <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">+</span><span class="n">size</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">){</span>
	    <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>	
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">sa</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;size of array a&quot;</span><span class="o">&lt;&lt;</span><span class="n">sa</span><span class="o">&lt;&lt;</span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">a1</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sa</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sa</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">a3</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sa</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">a4</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sa</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">a5</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sa</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">a6</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sa</span><span class="p">);</span>

    <span class="kt">int</span> <span class="n">b</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&quot;size of array b&quot;</span><span class="o">&lt;&lt;</span><span class="n">sb</span><span class="o">&lt;&lt;</span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sb</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sb</span> <span class="p">);</span>
    <span class="kt">int</span> <span class="n">b3</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sb</span> <span class="p">);</span>
    <span class="kt">int</span> <span class="n">b4</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sb</span> <span class="p">);</span>
    <span class="kt">int</span> <span class="n">b5</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">sb</span> <span class="p">);</span>
    <span class="kt">int</span> <span class="n">b6</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sb</span> <span class="p">);</span>
    <span class="kt">int</span> <span class="n">b7</span> <span class="o">=</span> <span class="n">Find</span><span class="p">(</span> <span class="n">b</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">sb</span> <span class="p">);</span>
	
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">a1</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">a2</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">a3</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">a4</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">a5</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">a6</span><span class="o">&lt;&lt;</span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">b1</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">b2</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">b3</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">b4</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">b5</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">b6</span><span class="o">&lt;&lt;</span><span class="sc">&#39; &#39;</span><span class="o">&lt;&lt;</span><span class="n">b7</span><span class="o">&lt;&lt;</span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3>Interesting Notes</h3>
<ul>
	<li>sizeof(array), if array was the integer array passed as a parameter, the sizeof(array) would give the actual size of the pointer, not the actual size of the array, as it interprets array as pointer. (C++ pass integer arrays as pointers). so it will be helpful to pass an integer array&#8217;s size info together with the array for child-function&#8217;s convenience.</li>
	<li>In the binary search phase, while you are jumping around using array&#8217;s index, watch out for the boundary, make sure to cover every corner.</li>
	<li>Binary Search is O(logn) efficient, as half of the search space is eliminated in each iteration.</li>
</ul>

    <small class="meta">September 15, 2013 | <a href='/2013/09/15/a-binary-search-in-sorted-array/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/08/14/a-little-study-on-requests/">A Little Study on Requests</a></h2>

    <h3>Overview</h3>
<p><a href="http://docs.python-requests.org/en/latest/">Requests</a> is a great python lib to handle http calls, it is simple and intuitive to use. But when actually implement your class, to handle exceptions raised by Requests, the official document seems to be a little slim on it. First, unlike urllib2, Requests does not treat http errors as exceptions (it has a status_code to reflect the error, but won&#8217;t actually raise the exception flag). So I implement a customized error class, combined with a if condition statement, I manage to catch the http error as an exception.</p>
<h3>Python code</h3>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="k">class</span> <span class="nc">APIError</span><span class="p">(</span><span class="ne">StandardError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_code</span> <span class="o">=</span> <span class="n">error_code</span> <span class="c">#code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="c">#msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>
        <span class="ne">StandardError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;APIError: </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">, request: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">c</span><span class="p">():</span>
    <span class="n">access_token</span> <span class="o">=</span> <span class="n">YOUR_TOKEN</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.douban.com/shuo/v2/statuses/&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:</span><span class="s">&#39;hello&#39;</span><span class="p">}</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Authorization&#39;</span><span class="p">:</span><span class="s">&#39;Bearer </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">h</span><span class="p">)</span>
	<span class="n">rr</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
	<span class="c"># example error response</span>
	<span class="c">#{&quot;msg&quot;:&quot;\u9700\u8981\u767b\u5f55&quot;,&quot;code&quot;:1000}</span>
	<span class="c">#{&#39;msg&#39;: invalid_access_token: YOUR_TOKEN&#39;, &#39;code&#39;: 103, &#39;request&#39;: &#39;POST /shuo/v2/statuses/&#39;}</span>
	<span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">__contains__</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">):</span>
	    <span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">rr</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="n">rr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span> <span class="n">rr</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;request&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">rr</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">e</span> <span class="c"># for debuggin</span>
	<span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">u&#39;requests.exceptions.ConnectionError&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s">&#39;request: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&#39;!</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">e</span> <span class="c"># for debuggin</span>
	<span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">u&#39;requests.exceptions.RequestException&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s">&#39;request: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TooManyRedirects</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&#39;!!</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span><span class="n">e</span> <span class="c"># for debuggin</span>
	<span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">u&#39;requests.exceptions.TooManyRedirects&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s">&#39;request: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">URLRequired</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&#39;!!!url missing </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">e</span> <span class="c"># for debuggin</span>
	<span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">u&#39;requests.exceptions.URLRequired&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s">&#39;request: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">url</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">APIError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;customized error&#39;</span>
	<span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">error_code</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">error</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
	<span class="k">print</span> <span class="s">&quot;renren_http_call: unexpected error </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span><span class="n">err</span>
	<span class="k">raise</span> <span class="n">APIError</span><span class="p">(</span><span class="s">u&#39;unkown code&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">d</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">c</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">r</span>
    <span class="k">except</span> <span class="n">APIError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
	<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
	<span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">error_code</span>
	<span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">error</span>
	<span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span>
</code></pre></div><p>c() is the child function that actually takes care of the requests calling. If in the response dictionary, there is a &#8216;code&#8217; key, (or you could use r.status_code != 200), that means there is a http error, and we could raise our customized error class to pass alone the error information to the mother function (or class), in our case, the function d().<br />
and in d()&#8217;s exception handling, you could deal with different situations by implement if condition statement, in the example code, I just print out the message for demo purpose.<br />
Hope this helps, enjoy :)</p>

    <small class="meta">August 14, 2013 | <a href='/2013/08/14/a-little-study-on-requests/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/08/11/a-little-note-on-renren-api/">A Little Note on Renren API</a></h2>

    <h3>Overview</h3>
<p>Renren is popular Chinese social website. This post introduces an easy way, and yet different from Douban&#8217;s photo uploading previews introduced, to upload photo to your Renren albums with Python requests.</p>
<h3>Python code</h3>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="n">YOUR_ACCESS_TOKEN</span>
<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;YOUR_IMAGE_FILE_PATH&#39;</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;file&#39;</span><span class="p">:</span><span class="n">fh</span><span class="p">}</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.renren.com/v2/photo/upload&#39;</span>
<span class="n">text</span> <span class="o">=</span> <span class="s">&#39;WORDS_TO_DESCRIBE_YOUR_PHOTO&#39;</span> 
<span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;description&#39;</span><span class="p">:</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;albumId&#39;</span><span class="p">:</span><span class="n">YOUR_ALBUMID</span><span class="p">,</span> <span class="s">&#39;access_token&#39;</span><span class="p">:</span><span class="n">access_token</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="c"># would give you the http call result</span>
<span class="n">r_json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c"># would give the result in json format</span>
</code></pre></div><p>Things to take extra care are: use &#8216;data&#8217; to pass your dictionary when make a <span class="caps">POST</span> call with requests, Multipart-Encoded File should be put in a dictionary and pass to &#8216;files&#8217;.<br />
cheers!</p>

    <small class="meta">August 11, 2013 | <a href='/2013/08/11/a-little-note-on-renren-api/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/08/08/thoughts-on-pushing-wind-power/">Thoughts on Pushing Wind Power</a></h2>

    <p style="text-align:center;"><img src="/images/posts/2013-08-08/windfarm.jpg" style="max-width:50%;" alt="" /><br />
<p align="center">photo courtesy of <a href="http://www.flickr.com/photos/vattenfall/3581236645/">Vattenfall</a></p></p>
<p>The process of pushing green energy is slow. Solar power, wind power, bio energy development are slow, and there are even some pushing-back on the implementation of wind farms. Some local residents fought against the implementation of wind farm off their coast because they worry about that they may lose their scenery to the ocean. I am a frequent commuter between Chicago and Champaign by train, and I find it anecdote to see those lovely white wind turbines standings on the horizon of the green farm ground. <br />
This brought me to think about how to push public&#8217;s acceptance to wind farm. People are slow to accept changes, and new technologies. I think about using popular culture as a break through point to re-introduce wind farm to people.<br />
Associations like a cruise trip to Titanic, empire state building to An affair to Remember and Sleepless Seattle, and Casablanca to, well, the movie Casablanca, the unforgettable movies were so successful that it creates a iconic association between the location where the movie was filmed and the story of the movie. Without personally experiencing it, people gradually accept the idea of a new life style, a new product, and eventually, a new technology. I propose that investment should be put together to write, and shot a good movie that associates wind farm with, maybe, say, a everlasting love story. Maybe there could even be a scene taken right in fhe vast farm ground, the  green farm ground filled the picture, our beautiful heroin stands right in front the white blades of wind turbine, and re-united her destined mate who just came back from a serious war fair. The background music is tear-drawing, and in the background of the picture, the entire wind farm is standing there. The moving story and beautiful scene would take influence in popular culture, with wind turbine in it, people would start to accept wind farm as a friendly, and even welcoming image.<br />
With this publicity, the next step is to raise more money from the public, with the money, there comes a chance to influence the D.C.. With persuasive lobbyists in D.C. influence Washington&#8217;s law-making in Gay-rights, Affirmative action, Petroleum and Environment fight, the green energy, especially the wind farm technology should equip themselves with a stronger and more influential lobby group. The later could put more persuasion on congressional decision. And by that time, we shall see a Renaissance of the green energy.</p>

    <small class="meta">August 08, 2013 | <a href='/2013/08/08/thoughts-on-pushing-wind-power/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/29/oauth2-authorization-using-python/">OAuth2 Authorization Using Python</a></h2>

    <h3>Overview</h3>
<p>As promised I am going to talk about getting the authorization from OAuth2. OAuth2 is a popular authorization protocol used by website like twitter, and other social websites in their APIs. Basic OAuth2 authorization involves two stages: first obtain authorization code, second obtain access_token.</p>
<h3>Python Demo</h3>
<p>Taking social website Douban as an example<br />
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">SCOPE</span> <span class="o">=</span> <span class="s">&#39;douban_basic_common,shuo_basic_r,shuo_basic_w&#39;</span> <span class="c"># getting more access by adding more parameters</span>
<span class="n">APP_KEY</span> <span class="o">=</span> <span class="n">YOUR_APP_KEY</span> <span class="c"># sometimes called API_KEY, obtain upon registration for API</span>
<span class="n">APP_SECRET</span> <span class="o">=</span> <span class="n">YOUR_APP_SECRET</span> <span class="c"># sometimes called API_SECRET, obtain upon registration for API</span>
<span class="n">REDIRECT_URI</span> <span class="o">=</span> <span class="n">YOUR_CALLBACK_URI</span> <span class="c"># this http address would be the address to receive authorization code, and access_token returned from website</span>
<span class="n">DOUBAN_RESPONSE_TYPE</span> <span class="o">=</span> <span class="s">&#39;code&#39;</span>
<span class="n">DOUBAN_AUTHORIZATION_URI</span> <span class="o">=</span> <span class="s">&quot;https://www.douban.com/service/auth2/&quot;</span>
<span class="n">DOUBAN_ACCESS_TOKEN_URI</span> <span class="o">=</span> <span class="s">&quot;https://www.douban.com/service/auth2/&quot;</span>
<span class="n">v</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;client_id&#39;</span><span class="p">:</span><span class="n">APP_KEY</span><span class="p">,</span> <span class="s">&#39;redirect_uri&#39;</span><span class="p">:</span><span class="n">REDIRECT_URI</span><span class="p">,</span><span class="s">&#39;response_type&#39;</span><span class="p">:</span><span class="s">&#39;code&#39;</span><span class="p">,</span><span class="s">&#39;scope&#39;</span><span class="p">:</span><span class="n">SCOPE</span><span class="p">}</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">url</span> <span class="o">=</span> <span class="n">DOUBAN_AUTHORIZATION_URI</span><span class="o">+</span><span class="n">params</span>
<span class="c"># now, go to your browser, go to your generated url, click on accept authorization, then you would be redirect to REDIRECT_URI+code=YOUR_AUTHORIZATION_CODE, the YOUR_AUTHORIZATION_CODE would be appended at the end of that address</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">YOUR_AUTHORIZATION_CODE</span>
<span class="c"># up to this point, you finished first step, obtain authorization code</span>
<span class="n">v2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;client_id&#39;</span><span class="p">:</span><span class="n">APP_KEY</span><span class="p">,</span> <span class="s">&#39;client_secret&#39;</span><span class="p">:</span><span class="n">APP_SECRET</span><span class="s">&#39;,&#39;</span><span class="n">redirect_uri</span><span class="s">&#39;:REDIRECT_URI, &#39;</span><span class="n">grant_type</span><span class="s">&#39;:&#39;</span><span class="n">authorization_code</span><span class="s">&#39;,&#39;</span><span class="n">code</span><span class="s">&#39;:code}</span>
<span class="n">url2</span> <span class="o">=</span> <span class="n">DOUBAN_ACCESS_TOKEN_URI</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url2</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">v2</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="c"># should be 200 if everything is right</span>
<span class="n">r_json</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="c"># now you could see response in json format, with access_token in it</span>
</code></pre></div></p>
<p>Just remember that first stage uses <span class="caps">HTTP</span> method <span class="caps">GET</span>, second stage uses <span class="caps">HTTP</span> method <span class="caps">POST</span> (that means you have to pass your encoded v2 to data, instead of params!!!)</p>
<p>Now you should have your access_token, go nuts!</p>

    <small class="meta">July 29, 2013 | <a href='/2013/07/29/oauth2-authorization-using-python/#disqus_thread'>View Comments</a></small>
  </div>

  <div class="post">
    <h2><a href="/2013/07/28/a-little-note-on-douban-api/">A Little Note on Douban API</a></h2>

    <h3>Overview</h3>
<p>Douban is a popular Chinese social cultural site. It integrates Book reading, movie criticism, city events, and miniblog together. <br />
From my past couple day&#8217;s experience, though most Chinese social websites open their <span class="caps">API</span>, but they all have different &#8216;tricks&#8217; to successfully send your http post and get commands. I had been confused on Douban&#8217;s photo uploading format for a while, and now I was hoping to share the points you should be careful when uploading your photo using urllib and urllib2 libraries from python.</p>
<h3>Encode your photo</h3>
<p>The format to encode the photo to pass to Douban could be very restrict. The following format works:</p>
<div class="highlight"><pre><code class="xml">------------0x14026e4be72\r\n
Content-Disposition: form-data; name=&quot;text&quot;\r\n\r\nDraw\r\n------------0x14026e4be72\r\n
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;hidden&quot;\r\n
Content-Length: 2019551\r\n
Content-Type: image/jpeg\r\n
Content-Transfer-Encoding: binary\n\r\n
YOUR_IMAGE BYTES
\r\n------------0x140297140d1\r\nContent-Disposition: form-data; name=&quot;source&quot;\r\n\r\nYOUR_APP_KEY\r\n------------0x140297140d1--\r\n
</code></pre></div><p>Things you should really keep in mind is that Douban needs a clear declaration of Content-Type, you need to restrictedly follow the format. Use mimetypes.types_map would return you a dictionary of types they have, and you could pass your uploading file&#8217;s extension as a key into mimetypes.types_map.get(YOUR_FILE_EXTENTION), and it should return you the correct answer for Content-Type. <br />
Also, 0&#215;14026e4be72 is just the boundary variable you could generate randomly.</p>
<p>Following is the python code:<br />
test_douban class</p>
<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">gzip</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">mimetypes</span>

<span class="k">def</span> <span class="nf">_encode_multipart</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="s">&#39; build a multipart/form-data body with randomly generated boundary &#39;</span>
    <span class="n">boundary</span> <span class="o">=</span> <span class="s">&#39;----------</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&#39;read&#39;</span><span class="p">):</span>
            <span class="c"># file-like object:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Disposition: form-data; name=&quot;</span><span class="si">%s</span><span class="s">&quot;; filename=&quot;hidden&quot;&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Length: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Type: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">_guess_content_type</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Transfer-Encoding: binary</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Content-Disposition: form-data; name=&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;--</span><span class="si">%s</span><span class="s">--</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">boundary</span>

<span class="k">def</span> <span class="nf">_guess_content_type</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;application/octet-stream&#39;</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c"># mimetyeps.types_map keys are stored in lower case, ex: &#39;.jpeg&#39;</span>
    <span class="k">return</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">types_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="s">&#39;application/octet-stream&#39;</span><span class="p">)</span>
</code></pre></div><p>This version of code is heavily depends on the existed code from internet. I just amended little bit on the encoding part to make the format be accepted by Douban.</p>
<p>call test_douban class</p>
<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">test_douban</span> <span class="kn">import</span> <span class="n">_encode_multipart</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.douban.com/shuo/v2/statuses/&#39;</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="n">YOUR_ACCESS_TOKEN</span>
<span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">PATH_TO_YOUR_IMAGE_FILE</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">THINGS_YOU_WANT_TO_SAY</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;text&#39;</span><span class="p">:</span><span class="n">status</span><span class="p">,</span> <span class="s">&#39;image&#39;</span><span class="p">:</span><span class="n">fh</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">:</span><span class="n">YOUR_APP_KEY</span><span class="p">}</span>
<span class="n">coded_params</span><span class="p">,</span> <span class="n">boundary</span> <span class="o">=</span> <span class="n">_encode_multipart</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="c"># after previews call, you have the encoded photo, and a random generated boundary</span>
<span class="n">req</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coded_params</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Accept-Encoding&#39;</span><span class="p">,</span> <span class="s">&#39;gzip&#39;</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Authorization&#39;</span><span class="p">,</span> <span class="s">&#39;Bearer </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">access_token</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s">&#39;multipart/form-data; boundary=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">boundary</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</code></pre></div><p>Now you should see the photo you just post on Douban&#8217;s miniblog. Cheers !</p>

    <small class="meta">July 28, 2013 | <a href='/2013/07/28/a-little-note-on-douban-api/#disqus_thread'>View Comments</a></small>
  </div>

</div>

<div class='paging'>
  
    <a href='/page2' class='older'>Older Posts</a>
  

  
  <div class='clear'></div>
</div>

        </div>
      </div>

      <div id="bottom" class="span8 offset4">
        <div class="well">
          <a href="/about/">About</a> |
          <a href="/archives/">Archives</a> |
          <a href="/acknowledgment/">Courtesy</a> |
          <a href="/atom.xml">feed</a>
        </div>
      </div>
    </div>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/javascripts/bootstrap.min.js"></script>

  <!-- Google Analytics Code 
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9947336-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
          'http://www') + '.google-analytics.com/ga.js';
      ga.setAttribute('async', 'true');
      document.documentElement.firstChild.appendChild(ga);
    })();

  </script>  -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
         (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
         m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
         })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-42183274-1', 'ericcj24.github.io');
        ga('send', 'pageview');
        
    </script>
    
</body>
</html>

